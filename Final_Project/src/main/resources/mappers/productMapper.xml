<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.mappers.productMapper">

	<select id="getCategories" resultType="String">
		SELECT product_cat
		FROM categories
	</select>
	
	<select id="orderProduct" resultType="com.itwillbs.domain.ProductDTO">
		<!-- SELECT * 
		FROM (SELECT @ROWNUM:=@ROWNUM+1 AS rank, A.product_title
				   , A.product_price, A.product_seller, A.product_pic
			  FROM product A, (SELECT @ROWNUM:=0) R ) B 
		<![CDATA[WHERE B.rank <= 20]]> -->
		
		
		SELECT *
		FROM( SELECT p.product_title
				   , p.product_price
				   , p.product_seller
				   , p.product_pic
				   , p.product_readcount
				   
			  FROM product p
			  <if test='GB.equals("date")'>
			  WHERE p.product_status = '판매중'
			  ORDER BY product_date DESC
			  </if>
			  <if test='GB.equals("views")'>
			  WHERE p.product_status = '판매중'
		 	  ORDER BY product_readcount DESC
			  </if>
			  <if test='GB.equals("wish")'>
			  JOIN wish w
			  on (p.product_num = w.product_num)
			  WHERE p.product_status = '판매중'
              GROUP BY p.product_title
              		 , p.product_price
              		 , p.product_seller
              		 , p.product_pic
              		 , p.product_readcount
			  ORDER BY count(w.product_num) DESC
			  </if>
			) A
		LIMIT 6
	</select>
	
	<resultMap type="map" id="productMap">
		<id column="product_num" property="productNum"/>
		<result column="product_seller" property="productSeller"/>
		<result column="product_cate" property="productCate"/>
		<result column="product_title" property="productTitle"/>
		<result column="product_content" property="productContent"/>
		<result column="product_price" property="productPrice"/>
		<result column="product_grade" property="productGrade"/>
		<result column="product_pic" property="productPic"/>
		<result column="product_readcount" property="productReadcount"/>
		<result column="product_date" property="productDate"/>
		<result column="mem_nname" property="memNname"/>
	</resultMap>
	
	<select id="productInfo" resultMap="productMap" parameterType="hashMap">
	
		<if test='productSeller != null'>
    	SELECT *
    	FROM (
  		</if>
			SELECT p.product_num as "product_num"
				  ,p.product_seller as "product_seller"
				  ,p.product_cate as "product_cate"
				  ,p.product_title as "product_title"
				  ,p.product_content as "product_content"
				  ,p.product_price as "product_price"
				  ,p.product_grade as "product_grade"
				  ,p.product_pic as "product_pic"
				  ,p.product_readcount as "product_readcount"
				  ,p.product_date as "product_date"
				  ,m.mem_nname as "mem_nname"
			FROM product p join members m
			on (p.product_seller = m.mem_id)
			<if test='productSeller == null'>
	    	WHERE product_num = CAST(#{productNum} AS decimal(7,0))
	  		</if>
  		<if test='productSeller != null'>
    	WHERE product_seller = #{productSeller}
    	AND product_num NOT IN (CAST(#{productNum} AS decimal(7,0)))
    	ORDER BY product_date DESC) A
    	LIMIT 4
  		</if>
  		
	</select>
	
</mapper>